apiVersion: apps/v1
kind: Deployment
metadata:
  name: worker-app
  namespace: default
spec:
  replicas: 2
  selector:
    matchLabels:
      app: worker-app
  template:
    metadata:
      labels:
        app: worker-app
    spec:
      containers:
      - name: worker
        image: python:3.11-slim
        command: ["python", "-c"]
        args:
          - |
            import redis
            import time
            r = redis.Redis(host='redis', port=6379, decode_responses=True)
            print("Worker started, listening for jobs...")
            while True:
              job = r.lpop('jobs')
              if job:
                print(f"Processing: {job}")
                time.sleep(1)
              else:
                time.sleep(0.1)
        resources:
          requests:
            cpu: 100m
            memory: 64Mi

